#! /usr/bin/env python

import sys
import os.path
import argparse
import datetime

def process(filename):
  if os.path.exists(filename):
    if os.path.isfile(filename):
        files[filename] = datetime.datetime.strftime(datetime.datetime.fromtimestamp(os.path.getmtime(filename)), "%Y/%m/%d %H:%M:%S.%f")
    else:
      sys.stderr.write("`%s` is not a regular file\n" % filename)
  else:
    sys.stderr.write("`%s` does not exist\n" % filename)

parser = argparse.ArgumentParser(description='List files by timestamp')
parser.add_argument('-n', '--nameonly', dest='nameonly', action='store_true', help='Display only names of files (no timestamp)')
parser.add_argument('filenames', metavar='filename', nargs='*', help='Names of files (or feed from stdin)')
args = parser.parse_args()

files = {}
if args.filenames:
  for filename in args.filenames:
    process(filename)
else:
  assert not sys.stdin.isatty(), "stdin must be redirected or you must specify files as arguments"
  for filename in sys.stdin.read().strip('\n').split('\n'):
    process(filename)

for filename in sorted(files, key=lambda file: files[file], reverse=True):
  print "%s%s" % ('' if args.nameonly else (files[filename] + ' '), filename)
