#! /usr/bin/env python

import sys
import os.path
import subprocess

def run(cmd):
  p = subprocess.Popen(cmd.split(), stdout=subprocess.PIPE, stderr=subprocess.PIPE)
  (stdout, stderr) = p.communicate()
  return (p.wait(), stdout.strip('\n'), stderr.strip('\n'))

failures = 0

for filename in sys.argv[1:]:
  (rc, lsOutput, stderr) = run("ls -ld %s" % filename)
  if (rc == 0) and (not stderr):
    md5sum = None
    if os.path.isdir(filename):
      md5sum = "n/a"
    else:
      (rc, md5Output, stderr) = run("md5sum %s" % filename)
      md5sum = md5Output.split()[0]
    print "%-32s %s" % (md5sum, lsOutput)
  else:
    sys.stderr.write("%s (%d)\n" % (stderr, rc))
    failures += 1

exit(0 if failures == 0 else 1)
