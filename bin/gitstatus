#! /usr/bin/env python

import re
import sys
import getopt
import subprocess

"""
(usp-venv-2017-06-07)[10:12:13][jpfuntne<ao-dev>@bxb-mitg7-dev23:/nobackup/jpfuntne/master/usp/uas]$ git status uas
On branch US39053-AutoDeploy_AutoVNF_support
Your branch is up-to-date with 'origin/US39053-AutoDeploy_AutoVNF_support'.
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   uas/uspc.py
        modified:   uas/workers/dep_worker.py

no changes added to commit (use "git add" and/or "git commit -a")
"""

def syntax(msg=None):
  if msg:
    sys.stderr.write('{msg}\n'.format(**locals()))
  sys.stderr.write('{pgm} [file ...]\n'.format(pgm=sys.argv[0]))
  exit(1)

(opts, args) = ([], [])
try:
  (opts, args) = getopt.getopt(sys.argv[1:], '', [])
except Exception as e:
  syntax(str(e))

cmd = ['git', 'status'] + args
p = subprocess.Popen(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
(stdout, stderr) = p.communicate()
rc = p.wait()
if (rc != 0) or stderr:
  syntax('{cmd} failed: {rc}, {stdout!r}, {stderr!r}'.format(**locals()))

modified_regex = re.compile('^\s+modified:\s+(.*)$')

for line in stdout.splitlines():
  match = modified_regex.search(line)
  if match:
    print match.group(1)
